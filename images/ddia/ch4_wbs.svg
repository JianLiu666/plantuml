<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1816px" preserveAspectRatio="none" style="width:1483px;height:1816px;background:#EFF1F3;" version="1.1" viewBox="0 0 1483 1816" width="1483px" zoomAndPan="magnify"><defs/><g><rect fill="#323232" height="26.1328" rx="7.5" ry="7.5" style="stroke:#323232;stroke-width:0.0;" width="251" x="605.75" y="10"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="239" x="611.75" y="27.6016">DDIA Chapter.4 - Encoding and Evolution</text><line style="stroke:#323232;stroke-width:1.5;" x1="731.25" x2="731.25" y1="36.1328" y2="56.1328"/><line style="stroke:#323232;stroke-width:1.5;" x1="92.5" x2="92.5" y1="56.1328" y2="76.1328"/><rect fill="#D3548A" height="26.1328" rx="7.5" ry="7.5" style="stroke:#D3548A;stroke-width:0.0;" width="165" x="10" y="76.1328"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153" x="16" y="93.7344">Formats for Encoding Data</text><line style="stroke:#323232;stroke-width:1.5;" x1="92.5" x2="102.5" y1="124.3984" y2="124.3984"/><rect fill="#EFF1F3" height="40.2656" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="308" x="102.5" y="104.2656"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="296" x="108.5" y="121.8672">In-memory 處理資料時透過不同的資料結構提高效率。</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="178" x="108.5" y="136">(e.g. list, hash table, tree, etc.)</text><line style="stroke:#323232;stroke-width:1.5;" x1="92.5" x2="102.5" y1="166.6641" y2="166.6641"/><rect fill="#EFF1F3" height="40.2656" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="306" x="102.5" y="146.5313"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="294" x="108.5" y="164.1328">傳遞資料(e.g. 網路, 資料庫) 時透過 encoding formats</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="60" x="108.5" y="178.2656">提高效率。</text><line style="stroke:#323232;stroke-width:1.5;" x1="92.5" x2="102.5" y1="201.8633" y2="201.8633"/><rect fill="#D3548A" height="26.1328" rx="7.5" ry="7.5" style="stroke:#D3548A;stroke-width:0.0;" width="167" x="102.5" y="188.7969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="155" x="108.5" y="206.3984">Language-Specific Formats</text><line style="stroke:#323232;stroke-width:1.5;" x1="186" x2="196" y1="229.9961" y2="229.9961"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="269" x="196" y="216.9297"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="257" x="202" y="234.5313">tied to a particular programming language。</text><line style="stroke:#323232;stroke-width:1.5;" x1="186" x2="196" y1="258.1289" y2="258.1289"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="216" x="196" y="245.0625"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="204" x="202" y="262.6641">方便性考量，通常不保證版本相容性。</text><line style="stroke:#323232;stroke-width:1.5;" x1="186" x2="196" y1="286.2617" y2="286.2617"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="183" x="196" y="273.1953"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="171" x="202" y="290.7969">不保證 encode/decode 效能。</text><line style="stroke:#323232;stroke-width:1.5;" x1="186" x2="186" y1="214.9297" y2="286.2617"/><line style="stroke:#323232;stroke-width:1.5;" x1="92.5" x2="102.5" y1="314.3945" y2="314.3945"/><rect fill="#D3548A" height="26.1328" rx="7.5" ry="7.5" style="stroke:#D3548A;stroke-width:0.0;" width="192" x="102.5" y="301.3281"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="180" x="108.5" y="318.9297">JSON, XML, and Binary Variants</text><line style="stroke:#323232;stroke-width:1.5;" x1="198.5" x2="208.5" y1="342.5273" y2="342.5273"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="213" x="208.5" y="329.4609"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="201" x="214.5" y="347.0625">human-readable, self-contained。</text><line style="stroke:#323232;stroke-width:1.5;" x1="198.5" x2="208.5" y1="370.6602" y2="370.6602"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="233" x="208.5" y="357.5938"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="221" x="214.5" y="375.1953">幾乎所有 apps/languages 都預設支援。</text><line style="stroke:#323232;stroke-width:1.5;" x1="198.5" x2="208.5" y1="398.793" y2="398.793"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="263" x="208.5" y="385.7266"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="251" x="214.5" y="403.3281">不同語言之間的對 datatype 定義不一定相同。</text><line style="stroke:#323232;stroke-width:1.5;" x1="198.5" x2="208.5" y1="426.9258" y2="426.9258"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="172" x="208.5" y="413.8594"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="160" x="214.5" y="431.4609">無法有效表示 binary string。</text><line style="stroke:#323232;stroke-width:1.5;" x1="198.5" x2="208.5" y1="455.0586" y2="455.0586"/><rect fill="#D3548A" height="26.1328" rx="7.5" ry="7.5" style="stroke:#D3548A;stroke-width:0.0;" width="103" x="208.5" y="441.9922"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="91" x="214.5" y="459.5938">Binary encoding</text><line style="stroke:#323232;stroke-width:1.5;" x1="260" x2="270" y1="490.2578" y2="490.2578"/><rect fill="#EFF1F3" height="40.2656" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="220" x="270" y="470.125"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="208" x="276" y="487.7266">建立在 JSON 之上的 binary encoding:</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="276" y="501.8594">e.g. MessagePack、BSON、etc.</text><line style="stroke:#323232;stroke-width:1.5;" x1="260" x2="270" y1="525.457" y2="525.457"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="305" x="270" y="512.3906"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="293" x="276" y="529.9922">更明確的 datatype，例如 integer 與 floating-point。</text><line style="stroke:#323232;stroke-width:1.5;" x1="260" x2="270" y1="553.5898" y2="553.5898"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="189" x="270" y="540.5234"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="177" x="276" y="558.125">仍然是 self-contained format。</text><line style="stroke:#323232;stroke-width:1.5;" x1="260" x2="260" y1="468.125" y2="553.5898"/><line style="stroke:#323232;stroke-width:1.5;" x1="198.5" x2="198.5" y1="327.4609" y2="455.0586"/><line style="stroke:#323232;stroke-width:1.5;" x1="92.5" x2="102.5" y1="581.7227" y2="581.7227"/><rect fill="#D3548A" height="26.1328" rx="7.5" ry="7.5" style="stroke:#D3548A;stroke-width:0.0;" width="163" x="102.5" y="568.6563"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="151" x="108.5" y="586.2578">Thrift and Protocol Buffers</text><line style="stroke:#323232;stroke-width:1.5;" x1="184" x2="194" y1="609.8555" y2="609.8555"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="352" x="194" y="596.7891"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="340" x="200" y="614.3906">均有 encoded schema definition 與 code genereation tool。</text><line style="stroke:#323232;stroke-width:1.5;" x1="184" x2="194" y1="637.9883" y2="637.9883"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="265" x="194" y="624.9219"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="253" x="200" y="642.5234">均透過 field tag 描述 field(取代 field name)。</text><line style="stroke:#323232;stroke-width:1.5;" x1="184" x2="194" y1="666.1211" y2="666.1211"/><rect fill="#D3548A" height="26.1328" rx="7.5" ry="7.5" style="stroke:#D3548A;stroke-width:0.0;" width="196" x="194" y="653.0547"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="184" x="200" y="670.6563">Field tags and schema evolution</text><line style="stroke:#323232;stroke-width:1.5;" x1="292" x2="302" y1="694.2539" y2="694.2539"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="129" x="302" y="681.1875"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="117" x="308" y="698.7891">對 field name 解耦。</text><line style="stroke:#323232;stroke-width:1.5;" x1="292" x2="302" y1="743.5859" y2="743.5859"/><rect fill="#EFF1F3" height="68.5313" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="292" x="302" y="709.3203"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="52" x="308" y="726.9219">向上相容:</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="174" x="312" y="741.0547">- 依序遞增 field tag 且不復用。</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="276" x="312" y="755.1875">- 根據 schema 決定是否跳過未給定的 field tags。</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="202" x="312" y="769.3203">- 只能刪除 optional marker fields。</text><line style="stroke:#323232;stroke-width:1.5;" x1="292" x2="302" y1="807.0508" y2="807.0508"/><rect fill="#EFF1F3" height="54.3984" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="218" x="302" y="779.8516"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="52" x="308" y="797.4531">向下相容:</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="184" x="312" y="811.5859">- 只能透過 optional 增加 fields。</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="202" x="312" y="825.7188">- 只能刪除 optional marker fields。</text><line style="stroke:#323232;stroke-width:1.5;" x1="292" x2="292" y1="679.1875" y2="807.0508"/><line style="stroke:#323232;stroke-width:1.5;" x1="184" x2="194" y1="849.3164" y2="849.3164"/><rect fill="#D3548A" height="26.1328" rx="7.5" ry="7.5" style="stroke:#D3548A;stroke-width:0.0;" width="199" x="194" y="836.25"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="187" x="200" y="853.8516">Datatypes and schema evolution</text><line style="stroke:#323232;stroke-width:1.5;" x1="293.5" x2="303.5" y1="877.4492" y2="877.4492"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="277" x="303.5" y="864.3828"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="265" x="309.5" y="881.9844">int32 -&gt; int64，再向上相容時可能會產生溢位。</text><line style="stroke:#323232;stroke-width:1.5;" x1="293.5" x2="303.5" y1="905.582" y2="905.582"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="401" x="303.5" y="892.5156"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="389" x="309.5" y="910.1172">protobuf 的 repeat marker 可以同保證 multi-value 與 single-value。</text><line style="stroke:#323232;stroke-width:1.5;" x1="293.5" x2="293.5" y1="862.3828" y2="905.582"/><line style="stroke:#323232;stroke-width:1.5;" x1="184" x2="184" y1="594.7891" y2="849.3164"/><line style="stroke:#323232;stroke-width:1.5;" x1="92.5" x2="102.5" y1="933.7148" y2="933.7148"/><rect fill="#D3548A" height="26.1328" rx="7.5" ry="7.5" style="stroke:#D3548A;stroke-width:0.0;" width="38" x="102.5" y="920.6484"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="26" x="108.5" y="938.25">Avro</text><line style="stroke:#323232;stroke-width:1.5;" x1="121.5" x2="131.5" y1="961.8477" y2="961.8477"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="222" x="131.5" y="948.7813"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="210" x="137.5" y="966.3828">為了解決 Hadoop 處理資料時的問題。</text><line style="stroke:#323232;stroke-width:1.5;" x1="121.5" x2="131.5" y1="989.9805" y2="989.9805"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="160" x="131.5" y="976.9141"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="148" x="137.5" y="994.5156">Avro IDL for developers。</text><line style="stroke:#323232;stroke-width:1.5;" x1="121.5" x2="131.5" y1="1018.1133" y2="1018.1133"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="258" x="131.5" y="1005.0469"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="246" x="137.5" y="1022.6484">JSON-like schema for machine-readable。</text><line style="stroke:#323232;stroke-width:1.5;" x1="121.5" x2="131.5" y1="1046.2461" y2="1046.2461"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="408" x="131.5" y="1033.1797"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="396" x="137.5" y="1050.7813">binary data 不包含 fields 與 datatypes，透過 writer/reader schema。</text><line style="stroke:#323232;stroke-width:1.5;" x1="121.5" x2="131.5" y1="1074.3789" y2="1074.3789"/><rect fill="#D3548A" height="26.1328" rx="7.5" ry="7.5" style="stroke:#D3548A;stroke-width:0.0;" width="276" x="131.5" y="1061.3125"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="264" x="137.5" y="1078.9141">The writer's schema and the reader's schema</text><line style="stroke:#323232;stroke-width:1.5;" x1="269.5" x2="279.5" y1="1102.5117" y2="1102.5117"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="229" x="279.5" y="1089.4453"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="217" x="285.5" y="1107.0469">省略 field tags 換來更有效的資料壓縮。</text><line style="stroke:#323232;stroke-width:1.5;" x1="269.5" x2="279.5" y1="1130.6445" y2="1130.6445"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="230" x="279.5" y="1117.5781"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="218" x="285.5" y="1135.1797">using writer schema to encode data。</text><line style="stroke:#323232;stroke-width:1.5;" x1="269.5" x2="279.5" y1="1158.7773" y2="1158.7773"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="322" x="279.5" y="1145.7109"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="310" x="285.5" y="1163.3125">reader schema 對照 writer schema 解析 binary data。</text><line style="stroke:#323232;stroke-width:1.5;" x1="269.5" x2="269.5" y1="1087.4453" y2="1158.7773"/><line style="stroke:#323232;stroke-width:1.5;" x1="121.5" x2="131.5" y1="1186.9102" y2="1186.9102"/><rect fill="#D3548A" height="26.1328" rx="7.5" ry="7.5" style="stroke:#D3548A;stroke-width:0.0;" width="143" x="131.5" y="1173.8438"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="131" x="137.5" y="1191.4453">Schema evolution rules</text><line style="stroke:#323232;stroke-width:1.5;" x1="203" x2="213" y1="1215.043" y2="1215.043"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="147" x="213" y="1201.9766"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="135" x="219" y="1219.5781">透過 union 保證相容性。</text><line style="stroke:#323232;stroke-width:1.5;" x1="203" x2="213" y1="1257.3086" y2="1257.3086"/><rect fill="#EFF1F3" height="54.3984" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="466" x="213" y="1230.1094"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="52" x="219" y="1247.7109">向上相容:</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="450" x="223" y="1261.8438">- new version of the schema as writer, and old version of schema as reader。</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="190" x="223" y="1275.9766">- 只能刪除有給定預設值的 fields。</text><line style="stroke:#323232;stroke-width:1.5;" x1="203" x2="213" y1="1320.7734" y2="1320.7734"/><rect fill="#EFF1F3" height="68.5313" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="477" x="213" y="1286.5078"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="52" x="219" y="1304.1094">向下相容:</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="461" x="223" y="1318.2422">- - new version of the schema as reader, and old version of schema as writer。</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="182" x="223" y="1332.375">- 增加 fields 時必須給定預設值。</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="315" x="223" y="1346.5078">- 允許更換 field name, 與 datatype(只要是可以轉換的)。</text><line style="stroke:#323232;stroke-width:1.5;" x1="203" x2="203" y1="1199.9766" y2="1320.7734"/><line style="stroke:#323232;stroke-width:1.5;" x1="121.5" x2="131.5" y1="1370.1055" y2="1370.1055"/><rect fill="#D3548A" height="26.1328" rx="7.5" ry="7.5" style="stroke:#D3548A;stroke-width:0.0;" width="190" x="131.5" y="1357.0391"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="178" x="137.5" y="1374.6406">But what is the writer's schema</text><line style="stroke:#323232;stroke-width:1.5;" x1="226.5" x2="236.5" y1="1398.2383" y2="1398.2383"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="191" x="236.5" y="1385.1719"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="242.5" y="1402.7734">Large file with lots of records。</text><line style="stroke:#323232;stroke-width:1.5;" x1="226.5" x2="236.5" y1="1426.3711" y2="1426.3711"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="265" x="236.5" y="1413.3047"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="253" x="242.5" y="1430.9063">Database with individually written records。</text><line style="stroke:#323232;stroke-width:1.5;" x1="226.5" x2="236.5" y1="1454.5039" y2="1454.5039"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="272" x="236.5" y="1441.4375"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="260" x="242.5" y="1459.0391">Sending records over a network connection。</text><line style="stroke:#323232;stroke-width:1.5;" x1="226.5" x2="236.5" y1="1482.6367" y2="1482.6367"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="186" x="236.5" y="1469.5703"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="174" x="242.5" y="1487.1719">wrier's schema 可以作為文件。</text><line style="stroke:#323232;stroke-width:1.5;" x1="226.5" x2="226.5" y1="1383.1719" y2="1482.6367"/><line style="stroke:#323232;stroke-width:1.5;" x1="121.5" x2="131.5" y1="1510.7695" y2="1510.7695"/><rect fill="#D3548A" height="26.1328" rx="7.5" ry="7.5" style="stroke:#D3548A;stroke-width:0.0;" width="197" x="131.5" y="1497.7031"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="185" x="137.5" y="1515.3047">Dynamically generated schemas</text><line style="stroke:#323232;stroke-width:1.5;" x1="230" x2="240" y1="1538.9023" y2="1538.9023"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="156" x="240" y="1525.8359"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144" x="246" y="1543.4375">Avro 只需修改 schemas。</text><line style="stroke:#323232;stroke-width:1.5;" x1="230" x2="240" y1="1567.0352" y2="1567.0352"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="267" x="240" y="1553.9688"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="255" x="246" y="1571.5703">Protobuf/Thrift 需要重新產生 encoding tool。</text><line style="stroke:#323232;stroke-width:1.5;" x1="230" x2="230" y1="1523.8359" y2="1567.0352"/><line style="stroke:#323232;stroke-width:1.5;" x1="121.5" x2="131.5" y1="1595.168" y2="1595.168"/><rect fill="#D3548A" height="26.1328" rx="7.5" ry="7.5" style="stroke:#D3548A;stroke-width:0.0;" width="303" x="131.5" y="1582.1016"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="291" x="137.5" y="1599.7031">Code generation and dynamically typed languages</text><line style="stroke:#323232;stroke-width:1.5;" x1="283" x2="293" y1="1623.3008" y2="1623.3008"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="457" x="293" y="1610.2344"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="445" x="299" y="1627.8359">Protobuf 在 statically typed language 可以將 binary data 轉成高效的資料結構。</text><line style="stroke:#323232;stroke-width:1.5;" x1="283" x2="293" y1="1651.4336" y2="1651.4336"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="282" x="293" y="1638.3672"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="270" x="299" y="1655.9688">Avro 對 dynamically typed language 更加友善。</text><line style="stroke:#323232;stroke-width:1.5;" x1="283" x2="283" y1="1608.2344" y2="1651.4336"/><line style="stroke:#323232;stroke-width:1.5;" x1="121.5" x2="121.5" y1="946.7813" y2="1595.168"/><line style="stroke:#323232;stroke-width:1.5;" x1="92.5" x2="102.5" y1="1679.5664" y2="1679.5664"/><rect fill="#D3548A" height="26.1328" rx="7.5" ry="7.5" style="stroke:#D3548A;stroke-width:0.0;" width="142" x="102.5" y="1666.5"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="130" x="108.5" y="1684.1016">The Merits of Schemas</text><line style="stroke:#323232;stroke-width:1.5;" x1="173.5" x2="183.5" y1="1707.6992" y2="1707.6992"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="389" x="183.5" y="1694.6328"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="377" x="189.5" y="1712.2344">JSON 可以提供嚴格的 regular expression, protobuf v3 and so on。</text><line style="stroke:#323232;stroke-width:1.5;" x1="173.5" x2="183.5" y1="1735.832" y2="1735.832"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="240" x="183.5" y="1722.7656"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="228" x="189.5" y="1740.3672">binary encoding 可以提供更好的壓縮率。</text><line style="stroke:#323232;stroke-width:1.5;" x1="173.5" x2="183.5" y1="1763.9648" y2="1763.9648"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="252" x="183.5" y="1750.8984"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="240" x="189.5" y="1768.5">schema 即文件，可以提早發現相容性問題。</text><line style="stroke:#323232;stroke-width:1.5;" x1="173.5" x2="183.5" y1="1792.0977" y2="1792.0977"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="426" x="183.5" y="1779.0313"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="414" x="189.5" y="1796.6328">承上，在 statically typed language 還可以在編譯階段發現型態不一致問題。</text><line style="stroke:#323232;stroke-width:1.5;" x1="173.5" x2="173.5" y1="1692.6328" y2="1792.0977"/><line style="stroke:#323232;stroke-width:1.5;" x1="92.5" x2="92.5" y1="102.2656" y2="1679.5664"/><line style="stroke:#323232;stroke-width:1.5;" x1="829.5" x2="829.5" y1="56.1328" y2="76.1328"/><rect fill="#F4B031" height="26.1328" rx="7.5" ry="7.5" style="stroke:#F4B031;stroke-width:0.0;" width="119" x="770" y="76.1328"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="107" x="776" y="93.7344">Modes of Dataflow</text><line style="stroke:#323232;stroke-width:1.5;" x1="829.5" x2="839.5" y1="117.332" y2="117.332"/><rect fill="#F4B031" height="26.1328" rx="7.5" ry="7.5" style="stroke:#F4B031;stroke-width:0.0;" width="179" x="839.5" y="104.2656"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="167" x="845.5" y="121.8672">Dataflow Through Databases</text><line style="stroke:#323232;stroke-width:1.5;" x1="929" x2="939" y1="145.4648" y2="145.4648"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="276" x="939" y="132.3984"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="264" x="945" y="150">傳送一份資料給未來的自己，必須保證向下相容。</text><line style="stroke:#323232;stroke-width:1.5;" x1="929" x2="939" y1="173.5977" y2="173.5977"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="366" x="939" y="160.5313"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="354" x="945" y="178.1328">rolling update 時需要保證向上相容，避免遺失 unknown fields。</text><line style="stroke:#323232;stroke-width:1.5;" x1="929" x2="939" y1="201.7305" y2="201.7305"/><rect fill="#F4B031" height="26.1328" rx="7.5" ry="7.5" style="stroke:#F4B031;stroke-width:0.0;" width="248" x="939" y="188.6641"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="236" x="945" y="206.2656">Different values written at different times</text><line style="stroke:#323232;stroke-width:1.5;" x1="1063" x2="1073" y1="229.8633" y2="229.8633"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="239" x="1073" y="216.7969"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="227" x="1079" y="234.3984">每個 column value 的改動時間都不相同。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1063" x2="1073" y1="257.9961" y2="257.9961"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="250" x="1073" y="244.9297"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="238" x="1079" y="262.5313">migration 成本過高，簡易做法為填上 null。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1063" x2="1063" y1="214.7969" y2="257.9961"/><line style="stroke:#323232;stroke-width:1.5;" x1="929" x2="939" y1="286.1289" y2="286.1289"/><rect fill="#F4B031" height="26.1328" rx="7.5" ry="7.5" style="stroke:#F4B031;stroke-width:0.0;" width="104" x="939" y="273.0625"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="92" x="945" y="290.6641">Archival storage</text><line style="stroke:#323232;stroke-width:1.5;" x1="991" x2="1001" y1="321.3281" y2="321.3281"/><rect fill="#EFF1F3" height="40.2656" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="333" x="1001" y="301.1953"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="321" x="1007" y="318.7969">Since you're copying the data anyway, you might as well</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="236" x="1007" y="332.9297">encode the copy of the data consistently.</text><line style="stroke:#323232;stroke-width:1.5;" x1="991" x2="991" y1="299.1953" y2="321.3281"/><line style="stroke:#323232;stroke-width:1.5;" x1="929" x2="929" y1="130.3984" y2="286.1289"/><line style="stroke:#323232;stroke-width:1.5;" x1="829.5" x2="839.5" y1="356.5273" y2="356.5273"/><rect fill="#F4B031" height="26.1328" rx="7.5" ry="7.5" style="stroke:#F4B031;stroke-width:0.0;" width="254" x="839.5" y="343.4609"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="242" x="845.5" y="361.0625">Dataflow Through Services: REST and RPC</text><line style="stroke:#323232;stroke-width:1.5;" x1="966.5" x2="976.5" y1="384.6602" y2="384.6602"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="168" x="976.5" y="371.5938"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="982.5" y="389.1953">傳輸協定舉例：HTTP、URLs</text><line style="stroke:#323232;stroke-width:1.5;" x1="966.5" x2="976.5" y1="412.793" y2="412.793"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="124" x="976.5" y="399.7266"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="112" x="982.5" y="417.3281">編碼協定舉例：JSON</text><line style="stroke:#323232;stroke-width:1.5;" x1="966.5" x2="976.5" y1="440.9258" y2="440.9258"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="359" x="976.5" y="427.8594"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="347" x="982.5" y="445.4609">近似於 DB query，差異在可以更嚴謹的限制 client 的可操作性。</text><line style="stroke:#323232;stroke-width:1.5;" x1="966.5" x2="976.5" y1="469.0586" y2="469.0586"/><rect fill="#F4B031" height="26.1328" rx="7.5" ry="7.5" style="stroke:#F4B031;stroke-width:0.0;" width="87" x="976.5" y="455.9922"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="75" x="982.5" y="473.5938">Web services</text><line style="stroke:#323232;stroke-width:1.5;" x1="1020" x2="1030" y1="497.1914" y2="497.1914"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="163" x="1030" y="484.125"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="151" x="1036" y="501.7266">兩大主流：REST 與 SOAP。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1020" x2="1030" y1="553.5898" y2="553.5898"/><rect fill="#EFF1F3" height="82.6641" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="391" x="1030" y="512.2578"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="29" x="1036" y="529.8594">REST</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="200" x="1040" y="543.9922">- 一種設計原則，稱為 RESTful API。</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="203" x="1040" y="558.125">- 簡單的資料格式與 URLs 描述功能。</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="111" x="1040" y="572.2578">- 沿用 HTTP 機制。</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="375" x="1040" y="586.3906">- 背後社群成熟，有相當優秀的 documentation tool(e.g. swagger)。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1020" x2="1030" y1="631.1875" y2="631.1875"/><rect fill="#EFF1F3" height="68.5313" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="248" x="1030" y="596.9219"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="30" x="1036" y="614.5234">SOAP</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="232" x="1040" y="628.6563">- based on HTTP 但採用 XML protocol。</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="137" x="1040" y="642.7891">- SOAP APIs -&gt; WSDL。</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="221" x="1040" y="656.9219">- 擁有 code generation tool 但不多元。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1020" x2="1020" y1="482.125" y2="631.1875"/><line style="stroke:#323232;stroke-width:1.5;" x1="966.5" x2="976.5" y1="680.5195" y2="680.5195"/><rect fill="#F4B031" height="26.1328" rx="7.5" ry="7.5" style="stroke:#F4B031;stroke-width:0.0;" width="299" x="976.5" y="667.4531"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="287" x="982.5" y="685.0547">The problems with remote procedure calls (RPCs)</text><line style="stroke:#323232;stroke-width:1.5;" x1="1126" x2="1136" y1="708.6523" y2="708.6523"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="300" x="1136" y="695.5859"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="288" x="1142" y="713.1875">希望能夠讓跨服務溝通過程像是在本地調用函式一樣。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1126" x2="1136" y1="736.7852" y2="736.7852"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="228" x="1136" y="723.7188"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="216" x="1142" y="741.3203">存在網路問題，無法準確判斷調用結果。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1126" x2="1136" y1="764.918" y2="764.918"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="180" x="1136" y="751.8516"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="168" x="1142" y="769.4531">承上，因此也存在冪等性問題。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1126" x2="1136" y1="800.1172" y2="800.1172"/><rect fill="#EFF1F3" height="40.2656" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="284" x="1136" y="779.9844"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="272" x="1142" y="797.5859">large object structure 的資料壓縮成本與跨語言的</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="91" x="1142" y="811.7188">datatype 約束。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1126" x2="1126" y1="693.5859" y2="800.1172"/><line style="stroke:#323232;stroke-width:1.5;" x1="966.5" x2="976.5" y1="835.3164" y2="835.3164"/><rect fill="#F4B031" height="26.1328" rx="7.5" ry="7.5" style="stroke:#F4B031;stroke-width:0.0;" width="162" x="976.5" y="822.25"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="150" x="982.5" y="839.8516">Current directions for RPC</text><line style="stroke:#323232;stroke-width:1.5;" x1="1057.5" x2="1067.5" y1="863.4492" y2="863.4492"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="303" x="1067.5" y="850.3828"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="291" x="1073.5" y="867.9844">當前主流：Thrift, Avro, gRPC(based on protobuf)。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1057.5" x2="1067.5" y1="891.582" y2="891.582"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="328" x="1067.5" y="878.5156"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="316" x="1073.5" y="896.1172">成熟的 frameworks 可以提供跨服務溝通帶來的傳輸問題。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1057.5" x2="1067.5" y1="919.7148" y2="919.7148"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="405" x="1067.5" y="906.6484"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="393" x="1073.5" y="924.25">RESTful API 因為方便性與社群成熟性來說，基本上是第三方串接時首選。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1057.5" x2="1057.5" y1="848.3828" y2="919.7148"/><line style="stroke:#323232;stroke-width:1.5;" x1="966.5" x2="976.5" y1="947.8477" y2="947.8477"/><rect fill="#F4B031" height="26.1328" rx="7.5" ry="7.5" style="stroke:#F4B031;stroke-width:0.0;" width="223" x="976.5" y="934.7813"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="211" x="982.5" y="952.3828">Data encoding and evolution for RPC</text><line style="stroke:#323232;stroke-width:1.5;" x1="1088" x2="1098" y1="975.9805" y2="975.9805"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="302" x="1098" y="962.9141"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="290" x="1104" y="980.5156">資料相容性的保證仍舊源於使用的 encoding format。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1088" x2="1098" y1="1004.1133" y2="1004.1133"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="213" x="1098" y="991.0469"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="201" x="1104" y="1008.6484">schema version 可以作為識別方式。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1088" x2="1098" y1="1032.2461" y2="1032.2461"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="274" x="1098" y="1019.1797"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="262" x="1104" y="1036.7813">RESTful API 可以將 version 加入 URL path 內。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1088" x2="1088" y1="960.9141" y2="1032.2461"/><line style="stroke:#323232;stroke-width:1.5;" x1="966.5" x2="966.5" y1="369.5938" y2="947.8477"/><line style="stroke:#323232;stroke-width:1.5;" x1="829.5" x2="839.5" y1="1060.3789" y2="1060.3789"/><rect fill="#F4B031" height="26.1328" rx="7.5" ry="7.5" style="stroke:#F4B031;stroke-width:0.0;" width="166" x="839.5" y="1047.3125"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="154" x="845.5" y="1064.9141">Message-Passing Dataflow</text><line style="stroke:#323232;stroke-width:1.5;" x1="922.5" x2="932.5" y1="1088.5117" y2="1088.5117"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="525" x="932.5" y="1075.4453"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="513" x="938.5" y="1093.0469">Asynchronous message-passing system，services 之間透過中繼站 message broker 溝通。</text><line style="stroke:#323232;stroke-width:1.5;" x1="922.5" x2="932.5" y1="1116.6445" y2="1116.6445"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="267" x="932.5" y="1103.5781"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="255" x="938.5" y="1121.1797">message passing from sender to recipient。</text><line style="stroke:#323232;stroke-width:1.5;" x1="922.5" x2="932.5" y1="1144.7773" y2="1144.7773"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="300" x="932.5" y="1131.7109"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="288" x="938.5" y="1149.3125">提高系統可靠性、實現服務溝通解耦、避免資料遺失。</text><line style="stroke:#323232;stroke-width:1.5;" x1="922.5" x2="932.5" y1="1172.9102" y2="1172.9102"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="239" x="932.5" y="1159.8438"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="227" x="938.5" y="1177.4453">request/response 的真實性是最大硬傷。</text><line style="stroke:#323232;stroke-width:1.5;" x1="922.5" x2="932.5" y1="1201.043" y2="1201.043"/><rect fill="#F4B031" height="26.1328" rx="7.5" ry="7.5" style="stroke:#F4B031;stroke-width:0.0;" width="111" x="932.5" y="1187.9766"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="99" x="938.5" y="1205.5781">Message brokers</text><line style="stroke:#323232;stroke-width:1.5;" x1="988" x2="998" y1="1229.1758" y2="1229.1758"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="280" x="998" y="1216.1094"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="268" x="1004" y="1233.7109">multi senders and recipients，關注相同 topic。</text><line style="stroke:#323232;stroke-width:1.5;" x1="988" x2="998" y1="1257.3086" y2="1257.3086"/><rect fill="#EFF1F3" height="26.1328" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="302" x="998" y="1244.2422"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="290" x="1004" y="1261.8438">資料相容性的保證仍舊源於使用的 encoding format。</text><line style="stroke:#323232;stroke-width:1.5;" x1="988" x2="988" y1="1214.1094" y2="1257.3086"/><line style="stroke:#323232;stroke-width:1.5;" x1="922.5" x2="932.5" y1="1285.4414" y2="1285.4414"/><rect fill="#F4B031" height="26.1328" rx="7.5" ry="7.5" style="stroke:#F4B031;stroke-width:0.0;" width="181" x="932.5" y="1272.375"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169" x="938.5" y="1289.9766">Distributed actor frameworks</text><line style="stroke:#323232;stroke-width:1.5;" x1="1023" x2="1033" y1="1327.707" y2="1327.707"/><rect fill="#EFF1F3" height="54.3984" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="330" x="1033" y="1300.5078"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="81" x="1039" y="1318.1094">Actor Model：</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="143" x="1043" y="1332.2422">- 單執行緒處理併發邏輯。</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="314" x="1043" y="1346.375">- actors 之間不共享資料，溝通屬於非同步且不保證成功。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1023" x2="1033" y1="1384.1055" y2="1384.1055"/><rect fill="#EFF1F3" height="54.3984" rx="7.5" ry="7.5" style="stroke:#A80036;stroke-width:0.0;" width="290" x="1033" y="1356.9063"/><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="181" x="1039" y="1374.5078">Distributed actor frameworks：</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="274" x="1043" y="1388.6406">- based on actor model and message broker。</text><text fill="#333333" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="227" x="1043" y="1402.7734">- 所有溝通都透過網路傳遞，保持一致性。</text><line style="stroke:#323232;stroke-width:1.5;" x1="1023" x2="1023" y1="1298.5078" y2="1384.1055"/><line style="stroke:#323232;stroke-width:1.5;" x1="922.5" x2="922.5" y1="1073.4453" y2="1285.4414"/><line style="stroke:#323232;stroke-width:1.5;" x1="829.5" x2="829.5" y1="102.2656" y2="1060.3789"/><line style="stroke:#323232;stroke-width:1.5;" x1="92.5" x2="829.5" y1="56.1328" y2="56.1328"/><!--MD5=[4842f6c52340fd2ecd4fd199d6430ec9]
@startwbs ch4_wbs

skinparam Shadowing false
skinparam BackgroundColor #EFF1F3
skinparam linetype ortho

<style>
arrow {
    LineColor #323232
}
node {
    Padding 6
    Margin 2
    RoundCorner 15
    LineThickness 0.0
    BackgroundColor #EFF1F3
    FontColor #333333
}
.Type_Root {
    BackgroundColor #323232
    FontColor #FFFFFF
    LineColor #323232
}
.Type1_Node {
    BackgroundColor #D3548A
    FontColor #FFFFFF
    LineColor #D3548A
}
.Type1_LeafNode {
    RoundCorner 0
    LineThickness 1.0
    LineColor #D3548A
}
.Type2_Node {
    BackgroundColor #F4B031
    FontColor #FFFFFF
    LineColor #F4B031
}
.Type2_LeafNode {
    RoundCorner 0
    LineThickness 1.0
    LineColor #F4B031
}
.Type3_Node {
    BackgroundColor #BD4231
    FontColor #FFFFFF
    LineColor #BD4231
}
.Type3_LeafNode {
    RoundCorner 0
    LineThickness 1.0
    LineColor #BD4231
}
.Type4_Node {
    BackgroundColor #0F5E8C
    FontColor #FFFFFF
    LineColor #0F5E8C
}
.Type4_LeafNode {
    RoundCorner 0
    LineThickness 1.0
    LineColor #0F5E8C
}
.Type5_Node {
    BackgroundColor #37A7A8
    FontColor #FFFFFF
    LineColor #37A7A8
}
.Type5_LeafNode {
    RoundCorner 0
    LineThickness 1.0
    LineColor #37A7A8
}
</style>

* DDIA Chapter.4 - Encoding and Evolution<<Type_Root>>

** Formats for Encoding Data<<Type1_Node>>
*** In-memory 處理資料時透過不同的資料結構提高效率。\n(e.g. list, hash table, tree, etc.)
*** 傳遞資料(e.g. 網路, 資料庫) 時透過 encoding formats\n提高效率。

*** Language-Specific Formats<<Type1_Node>>
**** tied to a particular programming language。
**** 方便性考量，通常不保證版本相容性。
**** 不保證 encode/decode 效能。

*** JSON, XML, and Binary Variants<<Type1_Node>>
**** human-readable, self-contained。
**** 幾乎所有 apps/languages 都預設支援。
**** 不同語言之間的對 datatype 定義不一定相同。
**** 無法有效表示 binary string。

**** Binary encoding<<Type1_Node>>
***** 建立在 JSON 之上的 binary encoding:\ne.g. MessagePack、BSON、etc.
***** 更明確的 datatype，例如 integer 與 floating-point。
***** 仍然是 self-contained format。

*** Thrift and Protocol Buffers<<Type1_Node>>
**** 均有 encoded schema definition 與 code genereation tool。
**** 均透過 field tag 描述 field(取代 field name)。

**** Field tags and schema evolution<<Type1_Node>>
***** 對 field name 解耦。
***** 向上相容:\n - 依序遞增 field tag 且不復用。\n - 根據 schema 決定是否跳過未給定的 field tags。\n - 只能刪除 optional marker fields。
***** 向下相容:\n - 只能透過 optional 增加 fields。\n - 只能刪除 optional marker fields。

**** Datatypes and schema evolution<<Type1_Node>>
***** int32 -> int64，再向上相容時可能會產生溢位。
***** protobuf 的 repeat marker 可以同保證 multi-value 與 single-value。

*** Avro<<Type1_Node>>
**** 為了解決 Hadoop 處理資料時的問題。
**** Avro IDL for developers。
**** JSON-like schema for machine-readable。
**** binary data 不包含 fields 與 datatypes，透過 writer/reader schema。

**** The writer's schema and the reader's schema<<Type1_Node>>
***** 省略 field tags 換來更有效的資料壓縮。
***** using writer schema to encode data。
***** reader schema 對照 writer schema 解析 binary data。

**** Schema evolution rules<<Type1_Node>>
***** 透過 union 保證相容性。
***** 向上相容:\n - new version of the schema as writer, and old version of schema as reader。\n - 只能刪除有給定預設值的 fields。
***** 向下相容:\n - - new version of the schema as reader, and old version of schema as writer。\n - 增加 fields 時必須給定預設值。\n - 允許更換 field name, 與 datatype(只要是可以轉換的)。

**** But what is the writer's schema<<Type1_Node>>
***** Large file with lots of records。
***** Database with individually written records。
***** Sending records over a network connection。
***** wrier's schema 可以作為文件。

**** Dynamically generated schemas<<Type1_Node>>
***** Avro 只需修改 schemas。
***** Protobuf/Thrift 需要重新產生 encoding tool。

**** Code generation and dynamically typed languages<<Type1_Node>>
***** Protobuf 在 statically typed language 可以將 binary data 轉成高效的資料結構。
***** Avro 對 dynamically typed language 更加友善。

*** The Merits of Schemas<<Type1_Node>>
**** JSON 可以提供嚴格的 regular expression, protobuf v3 and so on。
**** binary encoding 可以提供更好的壓縮率。
**** schema 即文件，可以提早發現相容性問題。
**** 承上，在 statically typed language 還可以在編譯階段發現型態不一致問題。

** Modes of Dataflow<<Type2_Node>>

*** Dataflow Through Databases<<Type2_Node>>
**** 傳送一份資料給未來的自己，必須保證向下相容。
**** rolling update 時需要保證向上相容，避免遺失 unknown fields。

**** Different values written at different times<<Type2_Node>>
***** 每個 column value 的改動時間都不相同。
***** migration 成本過高，簡易做法為填上 null。

**** Archival storage<<Type2_Node>>
***** Since you're copying the data anyway, you might as well\nencode the copy of the data consistently.

*** Dataflow Through Services: REST and RPC<<Type2_Node>>
**** 傳輸協定舉例：HTTP、URLs
**** 編碼協定舉例：JSON
**** 近似於 DB query，差異在可以更嚴謹的限制 client 的可操作性。

**** Web services<<Type2_Node>>
***** 兩大主流：REST 與 SOAP。
***** REST\n - 一種設計原則，稱為 RESTful API。\n - 簡單的資料格式與 URLs 描述功能。\n - 沿用 HTTP 機制。\n - 背後社群成熟，有相當優秀的 documentation tool(e.g. swagger)。
***** SOAP\n - based on HTTP 但採用 XML protocol。\n - SOAP APIs -> WSDL。\n - 擁有 code generation tool 但不多元。

**** The problems with remote procedure calls (RPCs)<<Type2_Node>>
***** 希望能夠讓跨服務溝通過程像是在本地調用函式一樣。
***** 存在網路問題，無法準確判斷調用結果。
***** 承上，因此也存在冪等性問題。
***** large object structure 的資料壓縮成本與跨語言的\ndatatype 約束。

**** Current directions for RPC<<Type2_Node>>
***** 當前主流：Thrift, Avro, gRPC(based on protobuf)。
***** 成熟的 frameworks 可以提供跨服務溝通帶來的傳輸問題。
***** RESTful API 因為方便性與社群成熟性來說，基本上是第三方串接時首選。

**** Data encoding and evolution for RPC<<Type2_Node>>
***** 資料相容性的保證仍舊源於使用的 encoding format。
***** schema version 可以作為識別方式。
***** RESTful API 可以將 version 加入 URL path 內。

*** Message-Passing Dataflow<<Type2_Node>>
**** Asynchronous message-passing system，services 之間透過中繼站 message broker 溝通。
**** message passing from sender to recipient。
**** 提高系統可靠性、實現服務溝通解耦、避免資料遺失。
**** request/response 的真實性是最大硬傷。

**** Message brokers<<Type2_Node>>
***** multi senders and recipients，關注相同 topic。
***** 資料相容性的保證仍舊源於使用的 encoding format。

**** Distributed actor frameworks<<Type2_Node>>
***** Actor Model：\n - 單執行緒處理併發邏輯。\n - actors 之間不共享資料，溝通屬於非同步且不保證成功。
***** Distributed actor frameworks：\n - based on actor model and message broker。\n - 所有溝通都透過網路傳遞，保持一致性。

@endwbs

PlantUML version 1.2021.7(Sun May 23 20:40:07 CST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: TW
--></g></svg>