<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="488px" preserveAspectRatio="none" style="width:742px;height:488px;background:#EFF1F3;" version="1.1" viewBox="0 0 742 488" width="742px" zoomAndPan="magnify"><defs/><g><rect fill="#FCD766" height="234.1738" style="stroke: #777777; stroke-width: 1.0;" width="10" x="119.5" y="65.7988"/><rect fill="#FCD766" height="239.1738" style="stroke: #777777; stroke-width: 1.0;" width="10" x="361.5" y="191.041"/><rect fill="#83828C" height="29.3105" style="stroke: #777777; stroke-width: 1.0;" width="10" x="596" y="65.7988"/><rect fill="#83828C" height="29.3105" style="stroke: #777777; stroke-width: 1.0;" width="10" x="596" y="191.041"/><rect fill="#83828C" height="29.3105" style="stroke: #777777; stroke-width: 1.0;" width="10" x="596" y="329.2832"/><rect fill="#EFF1F3" height="75.9316" style="stroke: #000000; stroke-width: 2.0;" width="479" x="241" y="152.4199"/><line style="stroke: #777777; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="124" x2="124" y1="34.4883" y2="448.2148"/><line style="stroke: #777777; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="366" x2="366" y1="34.4883" y2="448.2148"/><line style="stroke: #777777; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="601" x2="601" y1="34.4883" y2="448.2148"/><rect fill="#D98032" height="30.4883" style="stroke: #777777; stroke-width: 1.5;" width="73" x="88" y="3"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="95" y="23.5352">ThreadA</text><rect fill="#D98032" height="30.4883" style="stroke: #777777; stroke-width: 1.5;" width="73" x="88" y="447.2148"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="95" y="467.75">ThreadA</text><rect fill="#D98032" height="30.4883" style="stroke: #777777; stroke-width: 1.5;" width="71" x="331" y="3"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="338" y="23.5352">ThreadB</text><rect fill="#D98032" height="30.4883" style="stroke: #777777; stroke-width: 1.5;" width="71" x="331" y="447.2148"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="338" y="467.75">ThreadB</text><rect fill="#696773" height="30.4883" style="stroke: #777777; stroke-width: 1.5;" width="58" x="572" y="3"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="579" y="23.5352">Kernel</text><rect fill="#696773" height="30.4883" style="stroke: #777777; stroke-width: 1.5;" width="58" x="572" y="447.2148"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="579" y="467.75">Kernel</text><rect fill="#FCD766" height="234.1738" style="stroke: #777777; stroke-width: 1.0;" width="10" x="119.5" y="65.7988"/><rect fill="#FCD766" height="239.1738" style="stroke: #777777; stroke-width: 1.0;" width="10" x="361.5" y="191.041"/><rect fill="#83828C" height="29.3105" style="stroke: #777777; stroke-width: 1.0;" width="10" x="596" y="65.7988"/><rect fill="#83828C" height="29.3105" style="stroke: #777777; stroke-width: 1.0;" width="10" x="596" y="191.041"/><rect fill="#83828C" height="29.3105" style="stroke: #777777; stroke-width: 1.0;" width="10" x="596" y="329.2832"/><polygon fill="#666666" points="584,61.7988,594,65.7988,584,69.7988,588,65.7988" style="stroke: #666666; stroke-width: 1.0;"/><line style="stroke: #666666; stroke-width: 1.0;" x1="129.5" x2="590" y1="65.7988" y2="65.7988"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="136.5" y="61.0566">1.</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="152.5" y="61.0566">attempts to get lock</text><polygon fill="#666666" points="140.5,91.1094,130.5,95.1094,140.5,99.1094,136.5,95.1094" style="stroke: #666666; stroke-width: 1.0;"/><line style="stroke: #666666; stroke-width: 1.0;" x1="134.5" x2="600" y1="95.1094" y2="95.1094"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="146.5" y="90.3672">2.</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="162.5" y="90.3672">locked successful</text><line style="stroke: #666666; stroke-width: 1.0;" x1="129.5" x2="171.5" y1="124.4199" y2="124.4199"/><line style="stroke: #666666; stroke-width: 1.0;" x1="171.5" x2="171.5" y1="124.4199" y2="137.4199"/><line style="stroke: #666666; stroke-width: 1.0;" x1="130.5" x2="171.5" y1="137.4199" y2="137.4199"/><polygon fill="#666666" points="140.5,133.4199,130.5,137.4199,140.5,141.4199,136.5,137.4199" style="stroke: #666666; stroke-width: 1.0;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="136.5" y="119.6777">3.</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="152.5" y="119.6777">do something</text><path d="M241,152.4199 L315,152.4199 L315,159.4199 L305,169.4199 L241,169.4199 L241,152.4199 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="75.9316" style="stroke: #000000; stroke-width: 2.0;" width="479" x="241" y="152.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="256" y="165.9883">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="330" y="165.0547">[retry until got lock]</text><polygon fill="#666666" points="584,187.041,594,191.041,584,195.041,588,191.041" style="stroke: #666666; stroke-width: 1.0;"/><line style="stroke: #666666; stroke-width: 1.0;" x1="371.5" x2="590" y1="191.041" y2="191.041"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="378.5" y="186.2988">4.</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="394.5" y="186.2988">attempts to get lock</text><polygon fill="#666666" points="382.5,216.3516,372.5,220.3516,382.5,224.3516,378.5,220.3516" style="stroke: #666666; stroke-width: 1.0;"/><line style="stroke: #666666; stroke-width: 1.0;" x1="376.5" x2="600" y1="220.3516" y2="220.3516"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="388.5" y="215.6094">5.</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="404.5" y="215.6094">failed to get lock</text><rect fill="#EEEEEE" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="727" x="3" y="256.0068"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="730" y1="256.0068" y2="256.0068"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="730" y1="259.0068" y2="259.0068"/><rect fill="#EEEEEE" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="185" x="274" y="245.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="167" x="280" y="261.9199">When ThreadA unlocked</text><polygon fill="#666666" points="589,295.9727,599,299.9727,589,303.9727,593,299.9727" style="stroke: #666666; stroke-width: 1.0;"/><line style="stroke: #666666; stroke-width: 1.0;" x1="124.5" x2="595" y1="299.9727" y2="299.9727"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="131.5" y="295.2305">6.</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="147.5" y="295.2305">unlock</text><polygon fill="#666666" points="584,325.2832,594,329.2832,584,333.2832,588,329.2832" style="stroke: #666666; stroke-width: 1.0;"/><line style="stroke: #666666; stroke-width: 1.0;" x1="371.5" x2="590" y1="329.2832" y2="329.2832"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="378.5" y="324.541">7.</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="394.5" y="324.541">attempts to get lock</text><polygon fill="#666666" points="382.5,354.5938,372.5,358.5938,382.5,362.5938,378.5,358.5938" style="stroke: #666666; stroke-width: 1.0;"/><line style="stroke: #666666; stroke-width: 1.0;" x1="376.5" x2="600" y1="358.5938" y2="358.5938"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="388.5" y="353.8516">8.</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="404.5" y="353.8516">locked successful</text><line style="stroke: #666666; stroke-width: 1.0;" x1="371.5" x2="413.5" y1="387.9043" y2="387.9043"/><line style="stroke: #666666; stroke-width: 1.0;" x1="413.5" x2="413.5" y1="387.9043" y2="400.9043"/><line style="stroke: #666666; stroke-width: 1.0;" x1="372.5" x2="413.5" y1="400.9043" y2="400.9043"/><polygon fill="#666666" points="382.5,396.9043,372.5,400.9043,382.5,404.9043,378.5,400.9043" style="stroke: #666666; stroke-width: 1.0;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="378.5" y="383.1621">9.</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="394.5" y="383.1621">do something</text><polygon fill="#666666" points="589,426.2148,599,430.2148,589,434.2148,593,430.2148" style="stroke: #666666; stroke-width: 1.0;"/><line style="stroke: #666666; stroke-width: 1.0;" x1="366.5" x2="595" y1="430.2148" y2="430.2148"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="373.5" y="425.4727">10.</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="397.5" y="425.4727">unlock</text><!--
@startuml spin_lock

skinparam ParticipantPadding 80
skinparam BackgroundColor #EFF1F3
skinparam Shadowing false
skinparam sequence {
    ParticipantBorderColor #777777
    ParticipantFontColor #FFFFFF
    LifeLineBorderColor #777777
    ArrowColor #666666
    ArrowFontColor #333333
}

participant "ThreadA" as ta     #D98032
participant "ThreadB" as tb     #D98032
participant "Kernel"  as kernel #696773

autonumber "0."

ta -> kernel : attempts to get lock
activate ta #FCD766
activate kernel #83828C

kernel -> ta : locked successful
deactivate kernel

ta -> ta : do something

loop retry until got lock

    tb -> kernel : attempts to get lock
    activate tb #FCD766
    activate kernel #83828C

    kernel -> tb : failed to get lock
    deactivate kernel

end

== When ThreadA unlocked ==

ta -> kernel : unlock
deactivate ta

tb -> kernel : attempts to get lock
activate kernel #83828C

kernel -> tb : locked successful

deactivate kernel

tb -> tb : do something

tb -> kernel : unlock
deactivate tb

@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 CST 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 14.0.2+12-46
Operating System: Mac OS X
OS Version: 10.15.6
Default Encoding: UTF-8
Language: zh
Country: TW
--></g></svg>